Curvature Analysis

This script is a simple pipeline for measuring the curvature of illuminated membrane patches in images. This is done using a simple algorithm to detect membrane position and fits a circle to the points that make up the membrane. 

In Version 1.0.0:

	•	Text-based input for file paths and path validation to ensure desired location exists. 
	•	TaubinSVD pipeline for circle fitting as detailed for Matlab here: https://people.cas.uab.edu/~mosya/cl/TaubinSVD.m
	•	Single-frame visualizer to verify script analysis. 
	•	Visualization of selected points, range, region of interested on top of original image and region of interest including membrane brightness separated from original image. 

Prerequisties
	•	Python V3.7 or above
	•	Basic python knowledge 

Required Packages 
	•	bzip2                     1.0.8                  
	•	ca-certificates           2023.01.10             
	•	circle-fit                0.2.1                        
	•	contourpy                 1.0.7                    
	•	cv                        1.0.0                    
	•	cycler                    0.11.0                  
	•	fonttools                 4.39.4                   
	•	imageio                   2.31.0                   
	•	kiwisolver                1.4.4                    
	•	libffi                    3.4.4                 
	•	matplotlib                3.7.1                  
	•	ncurses                   6.4                  
	•	numpy                     1.24.3                  
	•	opencv-python             4.8.1.78              
	•	openssl                   1.1.1t            
	•	packaging                 23.1                     
	•	pandas                    2.0.2                  
	•	pillow                    9.5.0                    
	•	pip                       23.0.1          
	•	pyparsing                 3.0.9              
	•	python                    3.11.3              
	•	python-dateutil           2.8.2                  
	•	pytz                      2023.3                  
	•	readline                  8.2                 
	•	scipy                     1.10.1                 
	•	setuptools                67.8.0         
	•	six                       1.16.0                   
	•	sqlite                    3.41.2               
	•	tk                        8.6.12               
	•	tzdata                    2023.3                   
	•	wheel                     0.38.4            
	•	xz                        5.4.2                  
	•	zlib                      1.2.13 

This script has been validated on: 

	•	macOS Monterey 12.1 and above
	•	Linux Ubuntu 22.04 Jammy Jellyfish and above 
	•	Windows 10.x and above


Detailed installation and guided tutorial can be found at this link: https://drive.google.com/drive/folders/1p0MF4WHxX2Td0JwjXDQWnAkzZeyggV0-?usp=sharing

Quick Installation Guide (Expected installation time approx 5-10 minutes:

It is recommended all users of this script generate a new conda environment for the management of dependencies. 

	conda create —-name CurvatureF it #this can be any name you choose
	conda activate CurvatureFit
	conda install pip
	pip install matplotlib circle-fit os numpy pandas scipy imageio

In this environment the script CurvatureAnalysis.py can be activated and run. 

Quick Use Guide: 

1. Using terminal or preferred command line interface from the folder containing the desired script: 
	
	python CurvatureAnalysis.py

2. This will prompt you to input the location of the .txt files that describe the region if interested you have selected. See Detailed installation and guided tutorial for more information. 

	“Where are your txt files? include the final /:” #be sure to include the final “/“ example: /Users/johndoe/Desktop/TextFiles/

3. The script will then prompt you to input the desired location to save the output of this script. This location does not need to match the location of the text files and per version 1.0.0 it is encouraged you use a separate folder or the script will run successfully but report an error. See KNOWN ISSUES at the bottom of this file. 

4. Then you must input the predicted width of the membrane in pixels. This can be estimated using Fiji as desired in the Detailed installation and guided tutorial. 

5. You must then input if you’d like the script to save the image files generated by the script. “True” will save all images and “False” will not save images. If images are not needed, selecting “False” can dramatically increase computational speed. 

6. You will then be prompted to input which trial you would like to visualize. This step currently requires you to input a number in the 0000 - 9999 format as it references the file name directly. If you do not wish to visualize any of the trials you do not need to input any number or can input a comically large number. 

7. The script will then iterate over all .txt files in the folder location input in #2 until completion. 


DATA PREPARATION

	•	Within images, membranes must be selected within a specific region-of-interest (ROI). Once the ROI has been set, original images need to be cropped to that set region of interest. 
	•	Images should then be saved as .txt files that report the pixel value of each pixel within the frame of interested. 
	•	Patch membranes should run vertically from the top of the image to the bottom of the image, whether the curvature bends to the left or the right does not matter. 
	•	.txt files must follow the 0000-9999 naming format, the script does not currently pull from direct file names but rather generates a list of file names depending on the number of text-files in the reference folder. 
	•	Example file naming schema and directory organization can be seen in the DEMO dataset. 

DEMO DATA
This data is a selection of frames from a recording of TREK1 converted into .txt files of the cropped patch-containing ROI. It is a selection of approximately 115 total frames comprising 3 separate pressure steps. Using this dates should give you: 

	•	Results files titled Results_Original.csv and Results_Filtered.csv
	⁃	The Results_Filtered.csv will currently be blank as the filtering tool has not been fully tuned and is still in a demo-mode. Updates in future versions will supply a series of filtering tools. 
	•	Two folders titled “Results_Raw” and “Results_Filtered”
	⁃	Results_Raw will contain four images for each frame (assuming image saving was set to “True). 
	⁃	filenumber_Unfiltered.png will give you an image of the raw points selected by the script
	⁃	filenumber_boxrange.png will give you an image of the points that comprise either side of the range around the selected point. The width of this range is denoted by the “Membrane width” variable assigned before script running. 
	⁃	filenumber_shadedrange.png will give you an image of the predicted membrane area as set by “Membrane width” along with the brightest point of each row plotted within this range on top of the base image.
	⁃	filenumber_membranesnapshot.png will give you an image of the selected membrane area without overlaying this selection on top of the original image. This file is useful for seeing how the curvature changes on its own without additional noise from the native image.
	⁃	Results_Filtered will be empty until the filtering tool has been fully implemented in future versions of the script. 
	•	Demo dataset should take approximately 5 minutes to complete while saving images and no more than 2 minutes to complete while not saving images. 

KNOWN ISSUES V1.0.0 
	•	If there are additional non-text files within the directory containing the text files the script will report an error that it is looking for additional text files within the directory beyond the number of actual text files in said directory. This is because of the way the script currently generates the file list for analysis and is being worked on. As a workaround, make the text files directory a solitary directory with results and other relevant files in a parent or related directory above the text file directory. 

